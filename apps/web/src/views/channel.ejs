<% const body = () => { %>
  <section class="hero-panel">
    <div class="hero-panel__info">
      <span class="chip chip--glow">Private channel</span>
      <h1><%= channel.displayName %> (<%= channel.login %>)</h1>
      <p class="muted-copy">Connected since <%= connectedLabel %>. Clips are collected via chat and organized here by stream session.</p>
    </div>
    <div class="hero-panel__stats">
      <div class="stat-card">
        <p class="stat-label">Clips tracked</p>
        <p class="stat-value"><%= clipStats.total %></p>
        <span class="muted-copy">All viewer-sourced content</span>
      </div>
      <div class="stat-card">
        <p class="stat-label">Last request</p>
        <p class="stat-value"><%= lastClipLabel ?? 'No clips yet' %></p>
        <span class="muted-copy">Delivered via chat command</span>
      </div>
    </div>
  </section>

  <section class="panel panel--grid">
    <article class="panel-card">
      <h3>Clip signals</h3>
      <div class="status-grid">
        <div class="status-card">
          <strong><%= clipStats.ready %></strong>
          <span>Ready</span>
        </div>
        <div class="status-card">
          <strong><%= clipStats.failed %></strong>
          <span>Failed</span>
        </div>
        <div class="status-card">
          <strong><%= clipStats.pending %></strong>
          <span>Pending</span>
        </div>
        <div class="status-card">
          <strong><%= clipStats.total %></strong>
          <span>Total logged</span>
        </div>
      </div>
    </article>
    <article class="panel-card">
      <h3>Token</h3>
      <% if (token) { %>
        <p class="token-pill">Scopes: <%= token.scopes %></p>
        <p class="muted-copy">Expires <%= token.expiresLabel %></p>
      <% } else { %>
        <p class="muted-copy">Token metadata missing â€” reconnect to refresh scopes.</p>
        <a class="button secondary" href="/auth/twitch">Reconnect</a>
      <% } %>
    </article>
  </section>

  <section class="panel">
    <div class="panel-heading">
      <h2>Clip timeline</h2>
      <span class="chip">Viewer-sourced</span>
    </div>
    <% if (clipGroups.length === 0) { %>
      <p class="muted-copy">No clips recorded yet. Keep redeeming <code>!clip</code> and refresh to see requests populate this view.</p>
    <% } else { %>
      <% clipGroups.forEach((group) => { %>
        <article class="clip-session">
          <div class="clip-session__header">
            <div>
              <h3><%= group.label %></h3>
              <p><%= group.subtitle %></p>
            </div>
            <span class="clip-session__count"><%= group.clips.length %> clip<%= group.clips.length === 1 ? '' : 's' %></span>
          </div>
          <div class="clip-session__list">
            <% group.clips.forEach((clip) => {
              const tone =
                clip.status === 'ok' ? 'ok' : clip.status === 'failed' ? 'failed' : 'pending';
            %>
              <div class="clip-row">
                <div class="clip-row__meta">
                  <p class="clip-row__time"><%= clip.createdAtLabel %></p>
                  <p class="clip-row__note"><%= clip.note ?? 'No note provided' %></p>
                  <p class="muted-copy">by <%= clip.requestedBy %></p>
                </div>
                <div class="clip-actions">
                  <span class="clip-status clip-status--<%= tone %>">
                    <%= clip.status === 'ok' ? 'Ready' : clip.status === 'failed' ? 'Failed' : 'Pending' %>
                  </span>
                  <% if (clip.url) { %>
                    <a class="clip-link" href="<%= clip.url %>" target="_blank" rel="noreferrer">View clip</a>
                  <% } else if (clip.error) { %>
                    <p class="clip-error"><%= clip.error %></p>
                  <% } %>
                </div>
              </div>
            <% }) %>
          </div>
        </article>
      <% }) %>
    <% } %>
  </section>
<% } %>
<%- include('layout', { title: `${channel.displayName} clips`, body, sessionActive }) %>
